import{withModifiers as V,vModelDynamic as C,vModelText as S,vModelSelect as M,vModelCheckbox as U}from"./vue.runtime.esm-bundler-D_x3A6D8.js";import{d as D,r as E,j as _,k as j,c as s,o,a as r,F as d,g as k,b as m,h as y,t as i,f as h,n as x}from"./runtime-core.esm-bundler-Dr1X9nsB.js";const T={class:"dynamic-form"},L=["for"],R={key:0,class:"text-red-500"},B=["type","id","onUpdate:modelValue","placeholder","required","min","max","step"],F=["for"],O={key:0,class:"text-red-500"},z=["id","onUpdate:modelValue","placeholder","required","rows"],N=["for"],A={key:0,class:"text-red-500"},$=["id","onUpdate:modelValue","required"],H={value:""},J=["value"],P={key:3,class:"flex items-center gap-2 cursor-pointer"},X=["onUpdate:modelValue"],G={class:"text-sm text-gray-700"},I={key:4,class:"mt-1 text-sm text-red-500"},K={class:"flex items-center gap-4 pt-4"},Q=["disabled"],W={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},ee=D({__name:"DynamicForm",props:{action:{},method:{default:"POST"},fields:{},initialData:{default:()=>({})},submitLabel:{default:"Envoyer"},showReset:{type:Boolean,default:!1},csrfToken:{default:""}},emits:["success","error","submit"],setup(p,{emit:v}){const u=p,g=v,b=E(!1),n=_({}),c=_({});j(()=>{u.fields.forEach(t=>{c[t.name]=u.initialData[t.name]??t.default??""})});const w=()=>{Object.keys(n).forEach(a=>delete n[a]);let t=!0;return u.fields.forEach(a=>{const e=c[a.name];a.required&&!e&&(n[a.name]=`${a.label} est requis`,t=!1),a.type==="email"&&e&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||(n[a.name]="Email invalide",t=!1)),a.minLength&&typeof e=="string"&&e.length<a.minLength&&(n[a.name]=`Minimum ${a.minLength} caractères`,t=!1)}),t},f=async()=>{if(w()){b.value=!0,g("submit",{...c});try{const t=u.csrfToken||document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",a=await fetch(u.action,{method:u.method,headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":t},body:JSON.stringify(c)}),e=await a.json();if(!a.ok)throw e.errors&&Object.assign(n,e.errors),e;g("success",e),window.toast&&window.toast(e.message||"Succès !","success")}catch(t){if(g("error",t),window.toast){const a=t?.message||"Une erreur est survenue";window.toast(a,"error")}}finally{b.value=!1}}},q=()=>{u.fields.forEach(t=>{c[t.name]=u.initialData[t.name]??t.default??""}),Object.keys(n).forEach(t=>delete n[t])};return(t,a)=>(o(),s("div",T,[r("form",{onSubmit:V(f,["prevent"]),class:"space-y-4"},[(o(!0),s(d,null,k(p.fields,e=>(o(),s("div",{key:e.name,class:"form-group"},[["text","email","password","number"].includes(e.type)?(o(),s(d,{key:0},[r("label",{for:e.name,class:"block text-sm font-medium text-gray-700 mb-1"},[y(i(e.label)+" ",1),e.required?(o(),s("span",R,"*")):m("",!0)],8,L),h(r("input",{type:e.type,id:e.name,"onUpdate:modelValue":l=>c[e.name]=l,placeholder:e.placeholder,required:e.required,min:e.min,max:e.max,step:e.step,class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",{"border-red-500":n[e.name]}])},null,10,B),[[C,c[e.name]]])],64)):e.type==="textarea"?(o(),s(d,{key:1},[r("label",{for:e.name,class:"block text-sm font-medium text-gray-700 mb-1"},[y(i(e.label)+" ",1),e.required?(o(),s("span",O,"*")):m("",!0)],8,F),h(r("textarea",{id:e.name,"onUpdate:modelValue":l=>c[e.name]=l,placeholder:e.placeholder,required:e.required,rows:e.rows||3,class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none",{"border-red-500":n[e.name]}])},null,10,z),[[S,c[e.name]]])],64)):e.type==="select"?(o(),s(d,{key:2},[r("label",{for:e.name,class:"block text-sm font-medium text-gray-700 mb-1"},[y(i(e.label)+" ",1),e.required?(o(),s("span",A,"*")):m("",!0)],8,N),h(r("select",{id:e.name,"onUpdate:modelValue":l=>c[e.name]=l,required:e.required,class:x(["w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",{"border-red-500":n[e.name]}])},[r("option",H,i(e.placeholder||"Sélectionner..."),1),(o(!0),s(d,null,k(e.options,l=>(o(),s("option",{key:l.value,value:l.value},i(l.label),9,J))),128))],10,$),[[M,c[e.name]]])],64)):e.type==="checkbox"?(o(),s("label",P,[h(r("input",{type:"checkbox","onUpdate:modelValue":l=>c[e.name]=l,class:"w-4 h-4 rounded border-gray-300 text-blue-500 focus:ring-blue-500"},null,8,X),[[U,c[e.name]]]),r("span",G,i(e.label),1)])):m("",!0),n[e.name]?(o(),s("p",I,i(n[e.name]),1)):m("",!0)]))),128)),r("div",K,[r("button",{type:"submit",disabled:b.value,class:"px-6 py-2 bg-blue-500 hover:bg-blue-600 disabled:opacity-50 text-white font-medium rounded-lg transition-colors flex items-center gap-2"},[b.value?(o(),s("svg",W,[...a[0]||(a[0]=[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),y(" "+i(p.submitLabel),1)],8,Q),p.showReset?(o(),s("button",{key:0,type:"button",onClick:q,class:"px-6 py-2 border border-gray-300 hover:bg-gray-50 text-gray-700 font-medium rounded-lg transition-colors"}," Réinitialiser ")):m("",!0)])],32)]))}});export{ee as default};
